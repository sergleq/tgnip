# Резюме: Обход блокировок

## Что было добавлено

### 1. Ротация User-Agent
- Автоматическая смена User-Agent строк между запросами
- 6 популярных User-Agent по умолчанию (Chrome, Firefox, Safari, Edge)
- Возможность настройки пользовательских User-Agent через переменную окружения

### 2. Поддержка прокси-серверов
- HTTP/HTTPS прокси
- SOCKS5 прокси
- Настройка через переменную окружения `HTTP_PROXY_URL`

### 3. Механизм повторных попыток
- Настраиваемое количество повторных попыток (по умолчанию: 3)
- Настраиваемая задержка между попытками (по умолчанию: 2s)
- Умная логика: не повторяет для статусов 404, 403

### 4. Задержки между запросами
- Настраиваемая задержка между запросами (по умолчанию: 1s)
- Имитация человеческого поведения

### 5. Расширенные HTTP заголовки
- Accept, Accept-Language, Accept-Encoding
- Connection: keep-alive
- Upgrade-Insecure-Requests: 1

## Измененные файлы

### `content_extractor.go`
- Добавлена структура `HTTPClientConfig`
- Новая функция `createHTTPClient()` с поддержкой прокси
- Новая функция `makeRequestWithRetry()` с механизмом повторных попыток
- Новая функция `getRandomUserAgent()` для ротации User-Agent
- Обновлена функция `extractContent()` для использования новой конфигурации
- Добавлена функция `extractContentWithConfig()` для пользовательской конфигурации

### `config.go`
- Добавлены поля для HTTP конфигурации в структуру `Config`
- Новые функции для парсинга переменных окружения
- Функция `parseUserAgents()` для парсинга пользовательских User-Agent

### `main.go`
- Добавлена инициализация генератора случайных чисел

### `env.example`
- Обновлены примеры переменных окружения
- Добавлены новые параметры для обхода блокировок

## Новые переменные окружения

```bash
HTTP_TIMEOUT=30s               # Таймаут HTTP запросов
HTTP_RETRY_COUNT=3             # Количество повторных попыток
HTTP_RETRY_DELAY=2s            # Задержка между повторными попытками
HTTP_REQUEST_DELAY=1s          # Задержка между запросами
HTTP_PROXY_URL=                # URL прокси-сервера (опционально)
HTTP_USER_AGENTS=              # Пользовательские User-Agent (опционально)
```

## Обратная совместимость

✅ **Полностью сохранена**
- Все существующие функции работают без изменений
- Старые переменные окружения игнорируются (но не вызывают ошибок)
- API бота не изменился

## Тестирование

- Добавлены тесты для новой функциональности
- Все существующие тесты проходят
- Новая функциональность покрыта тестами

## Документация

- Создано подробное руководство `BLOCKING_BYPASS_GUIDE.md`
- Обновлен `env.example` с примерами конфигурации
- Добавлены примеры для разных сценариев использования

## Рекомендации по использованию

### Для обычных сайтов
```bash
HTTP_TIMEOUT=30s
HTTP_RETRY_COUNT=3
HTTP_RETRY_DELAY=2s
HTTP_REQUEST_DELAY=1s
```

### Для сайтов с защитой
```bash
HTTP_TIMEOUT=45s
HTTP_RETRY_COUNT=4
HTTP_RETRY_DELAY=3s
HTTP_REQUEST_DELAY=2s
```

### Для сложных сайтов с прокси
```bash
HTTP_TIMEOUT=60s
HTTP_RETRY_COUNT=5
HTTP_RETRY_DELAY=5s
HTTP_REQUEST_DELAY=3s
HTTP_PROXY_URL=http://your-proxy:8080
```

## Безопасность

- Используются только легальные методы обхода блокировок
- Соблюдение robots.txt и уважение к серверам
- Настраиваемые задержки для предотвращения перегрузки
- Логирование для мониторинга и отладки
