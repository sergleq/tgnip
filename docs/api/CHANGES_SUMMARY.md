# –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8080

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8080

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `webhook.go`:**
- –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å 8443 –Ω–∞ 8080
- –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/healthz` –¥–ª—è health check
- –°–æ—Ö—Ä–∞–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/health` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –°–µ—Ä–≤–µ—Ä —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PORT` –≤–º–µ—Å—Ç–æ `WEBHOOK_PORT`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `config.go`:**
- –û–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å 8443 –Ω–∞ 8080

### ‚úÖ 2. –≠–Ω–¥–ø–æ–∏–Ω—Ç /healthz

**–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/healthz`:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –í–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å, URL webhook –∏ –ø–æ—Ä—Ç
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Fly.io –¥–ª—è health check

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": "healthy",
  "webhook": "https://your-domain.com/webhook",
  "port": "8080"
}
```

### ‚úÖ 3. Webhook —Å secret_token

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Telegram-Bot-Api-Secret-Token` –≤ webhook –∑–∞–ø—Ä–æ—Å–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- Webhook –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- –¢–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ 4. Fly.toml –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- ‚úÖ –ü–æ—Ä—Ç 8080 –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
- ‚úÖ Health check –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `/healthz`
- ‚úÖ HTTPS –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç/—Å—Ç–æ–ø –º–∞—à–∏–Ω

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞:**
```toml
[env]
  PORT = '8080'

[http_service]
  internal_port = 8080

[[services.http_checks]]
  path = '/healthz'
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç

**–°–æ–∑–¥–∞–Ω `cmd/test_server/main.go`:**
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å `/healthz`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É GET/POST –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/webhook`
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω `WEBHOOK_SETUP.md`:**
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è
- –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Fly.toml –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- Health check —Ä–∞–±–æ—Ç–∞–µ—Ç

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
   ```bash
   fly deploy
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤:**
   ```bash
   fly secrets set TELEGRAM_BOT_TOKEN=your_bot_token
   fly secrets set WEBHOOK_URL=https://your-app.fly.dev
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```bash
   go run cmd/test_server/main.go
   ```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|-------|----------|--------|
| `/healthz` | GET | Health check | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `/health` | GET | Health check (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å) | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `/webhook` | POST | Telegram webhook | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| `/webhook` | GET | Method Not Allowed | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω |

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! üéâ
